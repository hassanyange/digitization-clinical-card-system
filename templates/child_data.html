{% extends "snippets/base.html" %}

{% block content %}

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

<!-- partial:partials/_navbar.html -->
{% include "snippets/navbar.html" %}

<!-- partial -->
<div class="container-fluid page-body-wrapper">
   <!-- partial:partials/_sidebar.html -->
   {% include "snippets/sidebar.html" %}
   <!-- partial -->
   <div class="main-panel">
      <div class="content-wrapper">
         <div class="d-xl-flex justify-content-between align-items-start">
            <!-- <h2 class="text-dark font-weight-bold mb-2"> Overview dashboard </h2> -->
         </div>
         <div class="row">
            <div class="col-md-12">
               <div class="col-lg-12 grid-margin stretch-card">
                  <div class="card">
                     <div class="card-body">
                        <h4 class="card-title">Child Details</h4>
                        {% include "snippets/messages.html" %}

                        <div class="container m-0">
                           <canvas id="container"></canvas>
                        </div>

                        <!-- <div class="container mt-4">
                           <table class="table table-bordered">
                              <thead>
                                 <tr>
                                    <th>Month</th>
                                    <th style="background-color: rgb(220,20,60);">BAD (Kg)</th>
                                    <th style="background-color: rgb(128,128,128);">WEAK (Kg)</th>
                                    <th style="background-color: rgb(50,205,50);">GOOD (Kg)</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <tr><td>1</td><td>0 - 2.8</td><td>2.9 – 3.5</td><td>3.6 - 5</td></tr>
                                 <tr><td>3</td><td>0 – 3.5</td><td>3.6 – 4.5</td><td>4.6 - 6</td></tr>
                                 <tr><td>6</td><td>0 – 4.5</td><td>4.6 – 5.5</td><td>5.6 - 8</td></tr>
                                 <tr><td>9</td><td>0 – 5.5</td><td>5.6 - 7</td><td>7.1 - 9</td></tr>
                                 <tr><td>12</td><td>0 - 6</td><td>6.1 – 7.5</td><td>7.6 - 10</td></tr>
                                 <tr><td>15</td><td>0 - 7</td><td>7.1 – 8.5</td><td>8.6 - 11</td></tr>
                                 <tr><td>18</td><td>0 - 7.5</td><td>7.6 - 9</td><td>9.1 – 11.5</td></tr>
                                 <tr><td>21</td><td>0 - 7.8</td><td>7.9 – 9.5</td><td>9.6 - 12</td></tr>
                                 <tr><td>24</td><td>0 - 8</td><td>8.1 – 9.8</td><td>9.9 – 12.5</td></tr>
                                 <tr><td>27</td><td>0 - 8.5</td><td>8.6 - 10</td><td>10.1 - 13</td></tr>
                                 <tr><td>30</td><td>0 - 9</td><td>9.1 – 10.5</td><td>10.6 – 13.5</td></tr>
                                 <tr><td>33</td><td>0 - 9.5</td><td>9.6 - 11</td><td>11.1 - 14</td></tr>
                                 <tr><td>36</td><td>0 - 9.7</td><td>9.8 – 11.5</td><td>11.6 – 14.5</td></tr>
                                 <tr><td>39</td><td>0 - 10</td><td>10.1 – 12</td><td>12.1 - 15</td></tr>
                                 <tr><td>42</td><td>0 - 10.2</td><td>10.3 – 12.5</td><td>12.6 – 15.5</td></tr>
                                 <tr><td>45</td><td>0 - 10.5</td><td>10.6 – 13</td><td>13.1 - 16</td></tr>
                                 <tr><td>48</td><td>0 - 10.8</td><td>10.9 – 13.5</td><td>13.6 – 16.5</td></tr>
                                 <tr><td>51</td><td>0 - 11</td><td>11.1 – 14</td><td>14.1 - 17</td></tr>
                                 <tr><td>54</td><td>0 - 11.5</td><td>11.6 – 14.5</td><td>14.6 – 17.2</td></tr>
                                 <tr><td>57</td><td>0 - 11.8</td><td>11.9 – 14.6</td><td>14.7 – 17.5</td></tr>
                                 <tr><td>60</td><td>0 - 12</td><td>12.1 – 15</td><td>15.1 - 18</td></tr>
                              </tbody>
                           </table>
                        </div> -->
                        
                        <br> <br> 

                        <div class="container">
                           <div class="form">
                              <form action="" method="POST">
                                 <div class="d-flex flex-wrap">
                                    {% csrf_token %}
                                    {% for field in form %}
                                    <div class="col-md-3">
                                       <div class="form-group p-1">
                                          <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                                          {{ field }}
                                       </div>
                                    </div>
                                    {% endfor %}
                                    <br>
                                    {% if not request.user.patient %}
                                    <button type="submit" name="child_weight_form_save" class="btn btn-primary h-100 w-100">SAVE</button>
                                    {% endif %}
                                 </div>
                              </form>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- content-wrapper ends -->
      <!-- partial:partials/_footer.html -->
      {% include "snippets/footer.html" %}
      <!-- partial -->
   </div>
   <!-- main-panel ends -->
</div>
<!-- page-body-wrapper ends -->
</div>

<!-- Modal -->
<div class="modal fade" id="addPatientModal" tabindex="-1" aria-labelledby="addPatientModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <div class="d-flex justify-content-between">
               <h5 class="modal-title" id="addPatientModalLabel">Add Patient</h5>
               <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
         </div>
         <div class="modal-body">
            <!-- Bootstraped Patient Form inside Modal -->
            <form method="post" action="">
               {% csrf_token %}
               {{ form.as_p }}
               <button type="submit" class="btn btn-primary">Submit</button>
            </form>
         </div>
      </div>
   </div>
</div>

<script>
   console.log(JSON.parse('{{ weight_data_json|escapejs }}'));
   console.log("jj")

   // Data for children's weight growth from age 0 to 15 months
   var weightData = JSON.parse('{{ weight_data_json|escapejs }}');

   // Now you can use weightData in your JavaScript code
   console.log(weightData);

   // Extracting data for x-axis and y-axis
   var ages = weightData.map(data => data.age);
   var weights = weightData.map(data => data.weight);
   
   // Interpolating the weights
   var interpolatedWeights = [];
   for (var i = 0; i < ages.length; i++) {
       interpolatedWeights.push(weights[i]);
       if (i < ages.length - 1) {
           var ageDiff = ages[i + 1] - ages[i];
           var weightDiff = weights[i + 1] - weights[i];
           for (var j = 1; j < ageDiff; j++) {
               interpolatedWeights.push(weights[i] + (weightDiff / ageDiff) * j);
           }
       }
   }

   // Creating the charts graph
   const ctx = document.getElementById('container').getContext('2d');
   new Chart(ctx, {
       type: 'line',
       data: {
         labels: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59'],
           datasets: [
           {
               label: 'WEIGHT',
               data: interpolatedWeights,
               borderColor: 'rgb(45, 85, 255, 1)',
               backgroundColor: 'rgb(45, 85, 255, 0.8)',
               fill: false,
               tension: 0.3,
               pointRadius: 0,
               responsive: true,
           }, 
           {
               label: 'BAD',
               data: [2, 2.5, 3, 3.4, 3.8, 4.1, 4.4, 4.7, 5, 5.3, 5.5, 5.7, 5.9, 6.1, 6.3, 6.5, 6.7, 6.9, 7.1, 7.3, 7.5, 7.65, 7.85, 8, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9, 9, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9, 10, 10.1, 10.2, 10.3, 10.4, 10.5, 10.6, 10.7, 10.8, 10.9, 11, 11.1, 11.2, 11.3, 11.4, 11.5, 11.6],
               borderColor: 'rgba(255, 0, 0, 1)',
               backgroundColor: 'rgba(255, 0, 0, 0.6)',
               fill: true,
               tension: 0.4,
               pointRadius: 0,
           }, {
               label: 'WEAK',
               data: [2.6, 3.1, 3.6, 4.1, 4.6, 5, 5.4, 5.8, 6.1, 6.4, 6.7, 7, 7.2, 7.4, 7.6, 7.8, 8, 8.2, 8.4, 8.6, 8.8, 9, 9.2, 9.4, 9.6, 9.8, 10, 10.2, 10.4, 10.6, 10.8, 11, 11.2, 11.4, 11.6, 11.8, 11.9, 12.1, 12.2, 12.3, 12.4, 12.5, 12.6, 12.7, 12.8, 12.9, 13, 13.1, 13.2, 13.3, 13.4, 13.5, 13.6, 13.7, 13.8, 13.9, 14, 14.1, 14.2, 14.3, 14.4, 14.5],
               borderColor: 'rgb(128,128,128, 1)',
               backgroundColor: 'rgb(128,128,128, 0.5)',
               fill: true,
               tension: 0.4,
               pointRadius: 0,
           }, {
               label: 'GOOD',
               data: [3.8, 4.4, 5, 5.6, 6.2, 6.8, 7.4, 8, 8.5, 9, 9.4, 9.7, 9.9, 10.08, 10.35, 10.5, 10.7, 10.9, 11.1, 11.3, 11.5, 11.7, 11.9, 12.1, 12.3, 12.5, 12.7, 12.9, 13.1, 13.3, 13.5, 13.7, 13.85, 14, 14.1, 14.2, 14.3, 14.4, 14.5, 14.6, 14.7, 14.8, 14.9, 15, 15.1, 15.2, 15.3, 15.4, 15.5, 15.6, 15.7, 15.8, 15.9, 16, 16.1, 16.2, 16.3, 16.4, 16.5, 16.6, 16.7, 16.8, 16.9],
               borderColor: 'rgb(22, 160, 133, 1)',
               backgroundColor: 'rgb(22, 160, 133, 0.5)',
               fill: true,
               tension: 0.4,
               pointRadius: 0,
           },
         ]
       },
       options: {
           scales: {
               y: {
                   beginAtZero: true,
                   max: 20,
                   title: {
                       display: true,
                       text: 'Weight (kg)'
                   },
                   grid: {
                     color: 'rgb(0,0,0,0.8)'
                   }
               },
               x: {
                   title: {
                       display: true,
                       text: 'Age (years)'
                   },
                   grid: {
                     color: 'rgb(0,0,0,0.8)'
                   }
               }
           },
           plugins: {
               title: {
                   display: true,
                   text: 'Growth Chart',
                   font: {
                       size: 18
                   }
               },
               legend: {
                   position: 'bottom'
               },
           }
       }
   });
</script>

{% endblock content %}
